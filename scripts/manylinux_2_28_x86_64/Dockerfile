# Minimal CUDA manylinux image for wheel building
FROM quay.io/pypa/manylinux_2_28_x86_64

# Install only essential CUDA components
ARG CUDA_VER="12-8"
ARG ARCH="x86_64"

# Install CUDA repository and minimal packages
RUN yum install -y yum-utils && \
    yum-config-manager --add-repo https://developer.download.nvidia.com/compute/cuda/repos/rhel8/x86_64/cuda-rhel8.repo && \
    yum -y install --setopt=install_weak_deps=False \
    cuda-cudart-${CUDA_VER}.${ARCH} \
    cuda-cudart-devel-${CUDA_VER}.${ARCH} \
    cuda-nvcc-${CUDA_VER}.${ARCH} \
    cuda-crt-${CUDA_VER}.${ARCH} && \
    yum clean all && \
    rm -rf /var/cache/yum/* /tmp/* /var/tmp/*

# Add CUDA lib path
RUN echo "/usr/local/cuda/lib64" >> /etc/ld.so.conf.d/999_nvidia_cuda.conf

# Set minimal CUDA environment
ENV CUDA_HOME=/usr/local/cuda \
    CUDA_ROOT=/usr/local/cuda \
    PATH="/usr/local/cuda/bin:${PATH}" \
    LD_LIBRARY_PATH="/usr/local/cuda/lib64:${LD_LIBRARY_PATH}"

CMD ["/bin/bash"]